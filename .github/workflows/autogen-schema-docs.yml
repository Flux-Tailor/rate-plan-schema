name: Autogen Schema Documentation 
on:
  workflow_dispatch:
    inputs:
      docsVersion:
        description: 'Version of documentation to create/overwrite'
        required: true

permissions:
  contents: write
  pull-requests: write

jobs:
  generate-doc:
    runs-on: ubuntu-latest
    env:
      SCRIPTING_LICENSE_KEY: ${{secrets.SCRIPTING_LICENSE_KEY}}

    steps:
    - name: Checkout main repo.
      uses: actions/checkout@v4

    - name: Checkout rate-plan-documentation repo.
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GIT_RATE_SCHEMA_DOCUMENTATION_TOKEN }}
        repository: Flux-Tailor/rate-plan-documentation
        ref: main
        path: rate-plan-documentation

    - name: Checkout Java 
      uses: actions/checkout@v4
      with:
        distribution: 'temurin' 
        java-version: '21'

    - name: Install Java 
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin' 
        java-version: '21'

    - name: Download & setup oxygen scripting
      run: |
        mkdir scripting
        cd scripting
        wget https://www.oxygenxml.com/InstData/Editor/All/oxygen.tar.gz
        tar -xzvf oxygen.tar.gz
        cd oxygen
        echo ${{ secrets.SCRIPTING_LICENSE_KEY }} > scriptinglicensekey.txt

    - name: Run an oxygen command
      run: |
        cd scripting/oxygen
        scripts/validate.sh  -h 


#    - name: Build with Gradle
#      run: |
#        cd scripting/build; ./gradlew generateDoc -PschemaFile=all_rate_plan_schemas.xsd -PinnerBuild=false --info --stacktrace --build-cache
#        mkdir -p ${{ github.workspace }}/rate-plan-documentation/doc/OxygenDocs/rate-plan-schema-docs/${{ inputs.docsVersion }}/
#        cp -r ${{ github.workspace }}/scripting/doc/* ${{ github.workspace }}/rate-plan-documentation/doc/OxygenDocs/rate-plan-schema-docs/${{ inputs.docsVersion }}/
#      shell: bash

#    - name: Create Pull Request
#      uses: peter-evans/create-pull-request@v7
#      with:
#        token: ${{ secrets.GIT_RATE_SCHEMA_DOCUMENTATION_TOKEN }}
#        path: rate-plan-documentation
#        commit-message: "[Flux Bot] New version of schema documentation"
